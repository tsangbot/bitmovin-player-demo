<!DOCTYPE html>
<!--
*
* Copyright (C) 2015, bitmovin GmbH, All Rights Reserved
*
* Created on: 2015-07-25 11:35:04
* Author:     bitmovin GmbH <dash-player@bitmovin.net>
*
* This source code and its use and distribution, is subject to the terms
* and conditions of the applicable license agreement.
*
-->
<html lang="en">
<head>
    <title>Bitmovin Demo - Adversting Scheudling</title>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet">
    <link rel="icon" type="image/png" href="images/bit-fav.png">
    <!-- Bitmovin Player -->
    <script type="text/javascript" src="//bitmovin-a.akamaihd.net/bitmovin-player/stable/7.1/bitmovinplayer.js">
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
            color: #000;
            font-weight: 300;
        }

        #banner {
            border-bottom: 1px solid #fff;
            background-color: #1eabe3;
            width: 100%
        }

        #banner h1 {
            margin: 0;
            padding: 30px;
            color: #fff;
        }

        .logo {
            padding: 10px;
            width: 25%;
            min-width: 350px;
            float: left;
            margin: auto;
        }

        .title {
            width: 75%;
            white-space: nowrap;
        }

        .clear {
            clear: both;
        }

        .content {
            margin-bottom: 10em;
        }

        h1, h2, h3, p {
            font-weight: 300;
            text-align: center;
            margin: 40px;
        }

        #webserver-warning {
            border: 1px solid #fff;
            padding: 10px;
            width: 70%;
            margin: auto;
            font-weight: 400;
            font-size: 0.8em;
            background: #f69c2a;
        }

        #webserver-warning h1, #webserver-warning h2 {
            font-weight: 400;
        }

        #player {
            max-width: 900px;
            width: 90%;
            margin: auto;
            -webkit-box-shadow: 0px 0px 56px 0px rgba(0, 0, 0, 0.75);
            -moz-box-shadow: 0px 0px 56px 0px rgba(0, 0, 0, 0.75);
            box-shadow: 0px 0px 56px 0px rgba(0, 0, 0, 0.75);
        }

        a {
            color: #97d9ef;
            font-weight: 400;
            text-decoration: none;
        }

        a:hover {
            color: #fff;
        }

        @media (max-width: 800px) {
            .logo {
                width: 80%;
            }

            .title {
                display: none;
            }
        }

        .col-sm-6.mb-3,.col-md-12 {
            margin: auto;
            width: 40%;
            padding: 5px;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <div id="banner">
        <div class="logo"><img src="images/bitmovin-logo.png"></div>
        <div class="title"><h1>Bitmovin Demo - Ad Scheduling</h1></div>
        <div class="clear"></div>
    </div>
    <div class="container">
        <h2>This demonstration covers Bitmovin Playerâ€™s ad insertion capabilities.</h2> 
        <p>By using Bitmovin Player's API, one could freely schedule ads in different position. </br>
        Bitmovin player supports playback of different advertising standards, includes VAST, VPAID, IMA and VMAP.</br>
        Try it for yourself, select the desired position and Ad standards then hit Schedule AD. To clear, hit Reset Configuration</p>    
        <div class="controls">
                <div class="row">
                    <div class="col-sm-6 mb-3">
                        <select id="adType" class="form-control">
                            <option selected="selected" value="vast">VAST</option>
                            <option value="vpaid">VPAID</option>
                            <option value="vmap">VMAP</option>
                            <option value="ima">IMA</option>
                        </select>
                        <select id="schedule-list" class="form-control">
                                <option selected="selected" value="pre">Ad position : pre-roll (0%)</option>
                                <option value="5%">Ad position : mid-roll(5%)</option>
                                <option value="10%">Ad position : mid-roll(10%)</option>
                                <option value="post">Ad position : post-roll (100%)</option>
                        </select>
                        <input id="scheudle-ad-button" class="btn btn-success mr-3 mt-2" type="button" value="Schedule AD">
                        <input id="reset-button" class="btn btn-warning mt-2" type="button" value="Reset Configuration">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-12">
                    <div id="ad-error"></div>
                </div>
                <div class="col-md-12">
                    <div id="ad-warning"></div>
                </div>
            </div>
            
        <br/><br/>
        <div class="content">
            <div class="player-wrapper">
                <div id="player"></div>
            </div>
            <div class="description">
                <p>For more information about the bitmovin player, please have a look at our online <a
                        href="//bitmovin.com/support" target="_blank">Developer Section</a>.</p>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    if (location.protocol === 'file:') {
        document.getElementById('webserver-warning').style.display = 'block';
    }

    var player;

    var conf = {
        key: '3c40c5d4-5107-4df0-92a9-b4dce564aeb5',
        playback: {
            muted: true
        },
        source: {
            dash: 'https://bitdash-a.akamaihd.net/content/MI201109210084_1/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd',
            hls: 'https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8',
            progressive: 'https://bitdash-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4',
            poster: 'https://bitdash-a.akamaihd.net/content/MI201109210084_1/poster.jpg'
        },
        style: {
            width: '100%',
            aspectratio: '16:9'
        },
        events: {
            onAdError: function (err) {
            document.querySelector('#ad-error').innerHTML = 'Ad-Error:' + err.message;
            },
            onWarning: function (err) {
            document.querySelector('#ad-warning').innerHTML = err.message;
            }
        }
    };

    document.querySelector('#scheudle-ad-button').addEventListener('click', loadConfig);
    document.querySelector('#reset-button').addEventListener('click', removeSchedule);

    player = bitmovin.player("player");

    player.setup(conf).then(function (value) {
        console.log('Successfully created Bitmovin Player instance'); // Success!
    }, function (reason) {
        console.log('Error while creating Bitmovin Player instance'); // Error!
    });



function resetAdError() {
  document.querySelector('#ad-error').innerHTML = '';
}

function loadConfig() {
  resetAdError();
  var adType = document.getElementById('adType').value || 'vast';
  var schedule = document.getElementById('schedule-list').value;
  if (schedule) {
      switch (adType) {
        case 'ima': {
          manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=[random]';
          break;
        }
        case 'vmap': {
          manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/ad_rule_samples&ciu_szs=300x250&ad_rule=1&impl=s&gdfp_req=1&env=vp&output=vmap&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ar%3Dpreonly&cmsid=496&vid=short_onecue&correlator=[random]';
          break;
        }
        case 'vpaid': {
          // same as VAST
          manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/32573358/skippable_ad_unit&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=http%3A%2F%2Freleasetest.dash-player.com%2Fads%2F&description_url=[description_url]&correlator=[random]';
          break;
        }
        default: {
          // reset to VAST
          manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/32573358/skippable_ad_unit&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=http%3A%2F%2Freleasetest.dash-player.com%2Fads%2F&description_url=[description_url]&correlator=[random]';
          document.getElementById('adType').value = 'vast';
        }
      }
    
    // vmap is handled as ima tag
    if (adType === 'vmap') {
      adType = 'ima';
    }
    player.scheduleAd(manifestUrl, adType, {
      'timeOffset': document.getElementById('schedule-list').value,
      'pertistant': true,
      'adMessage': 'This ad will end in {remainingTime} seconds'
    });
  }
  player.play();
}

function removeSchedule() {
  resetAdError();
  player.destroy();
  player = bitmovin.player('player');
  player.setup({
    key: '23c40c5d4-5107-4df0-92a9-b4dce564aeb5',
    playback: {
        muted: true
    },
    source: {
      dash: '//bitmovin-a.akamaihd.net/content/MI201109210084_1/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd',
      hls: '//bitmovin-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8',
      progressive: '//bitmovin-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4',
      poster: '//bitmovin-a.akamaihd.net/content/art-of-motion_drm/art-of-motion_poster.jpg'
    },
    events: {
      onAdError: function (err) {
        document.querySelector('#ad-error').innerHTML = 'Ad-Error:' + err.message;
      },
      onWarning: function (err) {
        document.querySelector('#ad-warning').innerHTML = err.message;
      }
    }
  });
}


</script>
</body>
</html>
